name: PR Labeler

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Label by PR title
        run: |
          title="${PR_TITLE}"
          labels=()
          case "${title,,}" in
            *perf*|*optimize*|*optimise*|*profiling*) labels+=("perf") ;;
          esac
          case "${title,,}" in
            bug|bug\ *|*\ bug|*\ bug\ *|fix|fix\ *|*\ fix|*\ fix\ *) labels+=("bug") ;;
          esac
          case "${title,,}" in
            *fri*) labels+=("FRI") ;;
          esac
          case "${title,,}" in
            *refactor*) labels+=("refactoring") ;;
          esac
          case "${title,,}" in
            *test*) labels+=("testing") ;;
          esac
          if [ ${#labels[@]} -gt 0 ]; then
            echo "${labels[*]}" | tr ' ' '\n' | xargs -I {} gh pr edit "${{ github.event.pull_request.number }}" --repo "${{ github.repository }}" --add-label "{}"
          fi
        env:
          GH_TOKEN: ${{ github.token }}
          PR_TITLE: ${{ github.event.pull_request.title }}

      - uses: actions/labeler@v5
        with:
          sync-labels: true
